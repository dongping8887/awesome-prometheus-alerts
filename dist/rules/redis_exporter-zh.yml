# Redis服务监控
groups:
  - name: Redis服务监控
    rules:
      - alert: Redis服务停止
        expr: redis_up == 0
        for: 1m
        labels:
          severity: 严重告警
        annotations:
          summary: "Redis服务停止，当前状态：{{ $value }}"
          description: "Redis服务停止运行"

      - alert: Redis内存使用率太高
        expr: redis_memory_used_bytes / redis_memory_max_bytes * 100 > 90
        for: 2m
        labels:
          severity: 严重告警
        annotations:
          summary: "Redis内存使用率太高"
          description: "Redis内存使用率太高（>90%），当前值：{{$value}}"

      - alert: Redis连接数过多
        expr: redis_connected_clients > 500
        for: 1m
        labels:
          severity: 严重告警
        annotations:
          summary: "Redis连接数过多"
          description: "Redis连接数过多（>500），当前连接数：{{ $value }}"

      - alert: Redis的key中项增长率太高
        expr: irate(redis_key_size[5m]) > 1000
        for: 1m
        labels:
          severity: 严重告警
        annotations:
          summary: "Redis的key中项增长率太高"
          description: "Redis的key中项增长率太高（>1000），当前速率：{{ $value }}"

      - alert: Redis的key中项太多
        # 排除榆林现场字符串项，每个字符串都1M多
        expr: redis_key_size{key!~".*trans.data.base.line.point|35c107354a6bfe20b7ff368a975b2f027a7758ab"} > 1000000
        for: 1m
        labels:
          severity: 告警
        annotations:
          summary: "Redis的key中项太多"
          description: "Redis的key中项太多（>1000000），db: {{ $labels.db }}，key: {{ $labels.key }}，当前值：{{ $value }}"
